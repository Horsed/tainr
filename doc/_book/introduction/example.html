<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Example | tainr</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="GitbookIO">
        <meta name="description" content="*tainr* is ought to be a monitoring service that aims for high customizability. It will enable you to monitor anything from process metrics to business events. You can write your own monitoring indicators and handlers which are basically just Node.js modules that use the same interprocess ```EventEmitter```. Indicators are those parts that test/monitor something and send monitoring events. Handlers will listen for those events and send emails or log something or do whatever you want. tainr will provide a [socket.io](http://socket.io) integration so you can even write handlers that do something **in your frontend**. The underlying messaging is based on [zeromq](http://zeromq.org) so you can connect tainr to your existing zeromq based pub/sub infrastructure. This makes it easy to monitor all events going through your app. You can also let tainr use its own pub/sub infrastructure.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../configuration/README.html" />
        
        
        <link rel="prev" href="../index.html" />
        

        <meta property="og:title" content="Example | tainr">
        <meta property="og:site_name" content="tainr">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/GitbookIO">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="..\gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        
    <div class="book" data-github="GitbookIO/javascript" data-level="1" data-basepath=".." data-revision="1397734679652">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/GitbookIO/javascript" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    
    <a href="https://github.com/GitbookIO/javascript/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/GitbookIO/javascript/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1><a href="../" >tainr</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/GitbookIO" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/javascript/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/javascript/edit/master/introduction/example.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="introduction/example.html">
                
                <a href="../introduction/example.html">
                    <i class="fa fa-check"></i> <b>1.</b> Example
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="configuration/README.html">
                
                <a href="../configuration/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> Configuration
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="custom/README.html">
                
                <a href="../custom/README.html">
                    <i class="fa fa-check"></i> <b>3.</b> Custom Indicators and Handlers
                </a>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 33.333333333333336%;min-width: 0%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../introduction/example.html" title="Example" class="chapter done new-chapter" data-progress="1" style="left: 33.333333333333336%;"></a>
    
        <a href="../configuration/README.html" title="Configuration" class="chapter  new-chapter" data-progress="2" style="left: 66.66666666666667%;"></a>
    
        <a href="../custom/README.html" title="Custom Indicators and Handlers" class="chapter  new-chapter" data-progress="3" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_4">
                    
                        <h1 id="example">Example</h1>
<p>Suppose you&#39;ve got a Node.js app or service that runs in it&#39;s own process and you want to monitor some process information like the CPU usage. There are tools for this like <a href="https://github.com/Unitech/pm2" target="_blank">pm2</a>. But suppose you want to monitor some business events that occur in your app/service and you want to send an email and pop up an alert in another app. Let&#39;s first setup this Node.js service:</p>
<blockquote>
<p>my-node-app.js</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
  , app = express()

  , HeartbeatIndicator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tainr'</span>).Heartbeat
  , heartbeatIndicator = <span class="hljs-keyword">new</span> Heartbeat({serviceId: <span class="hljs-string">'my-node-app'</span>}); <span class="hljs-comment">// will periodically emit a heartbeat event;</span>

app.post(<span class="hljs-string">'/items'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> {</span>
  res.send([{id: <span class="hljs-string">'item1'</span>}, {id: <span class="hljs-string">'item2'</span>}]);
});

app.listen(<span class="hljs-number">80</span>);
console.log(<span class="hljs-string">'my-node-app is running on port 80...'</span>);
</code></pre>
<p>This example REST service uses the <em>heartbeat indicator</em> to periodically emit a heartbeat event with the service&#39;s identifier. We will now look at a monitoring handler that <strong>runs in another process</strong> and logs the service id whenever it receives a heartbeat event.</p>
<blockquote>
<p>my-heartbeat-handler.js</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> Tainr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tainr'</span>).Tainr
  , tainr = <span class="hljs-keyword">new</span> Tainr();

tainr.on(<span class="hljs-string">'heartbeat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(serviceId)</span> {</span>
  console.log(serviceId);
});

console.log(<span class="hljs-string">'my-heartbeat-handler is running...'</span>);
</code></pre>
<p>As you can see, tainr is a Node.js <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter" target="_blank"><code>EventEmitter</code></a> and is used to listen for <code>heartbeat</code> events that will be emitted by <code>my-node-app.js</code>. Next we&#39;ll see how to connect the monitoring event system to the <a href="http://socket.io/" target="_blank">socket.io</a> backend of a simple status page:</p>
<blockquote>
<p>my-status-page.js</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
  , app = express()
  , server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>).createServer(app)

  , io = <span class="hljs-built_in">require</span>(<span class="hljs-string">'socket.io'</span>).listen(server)

  , Tainr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tainr'</span>).Tainr
  , tainr = <span class="hljs-keyword">new</span> Tainr();

server.listen(<span class="hljs-number">3000</span>);
console.log(<span class="hljs-string">'my-status-page is running on port 3000...'</span>);

app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(req, res)</span> {</span>
  res.sendfile(__dirname + <span class="hljs-string">'/my-status-page-frontend.html'</span>);
});

io.sockets.on(<span class="hljs-string">'connection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(socket)</span> {</span>
  tainr.wrap(socket);
});
</code></pre>
<p>In this example <a href="http://expressjs.com/" target="_blank">express</a> app, we&#39;re connecting the socket.io socket to the tainr <code>EventEmitter</code>. That means, all monitoring events emitted through tainr will be automagically emitted with this socket.io socket. Now we can write a monitoring handler for the browser:</p>
<blockquote>
<p>my-status-page-frontend.html</p>
</blockquote>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/socket.io/socket.io.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">var</span> socket = io.connect(<span class="hljs-string">'http://localhost'</span>);
  socket.on(<span class="hljs-string">'heartbeat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(serviceId)</span> {</span>
    alert(<span class="hljs-string">'service '</span> + serviceId + <span class="hljs-string">' is alive!'</span>);
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>This example socket.io frontend will alert you whenever the heartbeat event occours. While that is less useful, it shows you, how to write tainr monitoring handlers for a frontend. Let&#39;s just start all the services and apps for the sake of completeness:</p>
<pre><code>$ tainr start
tainr <span class="hljs-keyword">is</span> <span class="hljs-property">running</span>...

$ node ~/dev/<span class="hljs-keyword">my</span>-heartbeat-handler.js
<span class="hljs-keyword">my</span>-heartbeat-handler <span class="hljs-keyword">is</span> <span class="hljs-property">running</span>...

$ node ~/dev/<span class="hljs-keyword">my</span>-node-app.js
<span class="hljs-keyword">my</span>-node-app <span class="hljs-keyword">is</span> <span class="hljs-property">running</span> <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> port <span class="hljs-number">80.</span>..

$ node ~/dev/<span class="hljs-keyword">my</span>-status-page.js
<span class="hljs-keyword">my</span>-status-page <span class="hljs-keyword">is</span> <span class="hljs-property">running</span> <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> port <span class="hljs-number">3000.</span>..
</code></pre><p>Note that <code>my-heartbeat-handler</code> doesn&#39;t have to be started manually. You can also configure tainr to start your handlers automatically when tainr starts.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../index.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../configuration/README.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
        <link rel="stylesheet" href="..\gitbook/style.css">
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="..\gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="..\gitbook/app.js"></script>
        
    </body>
</html>
